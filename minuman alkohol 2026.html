<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Admin Penjualan</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body{background:#f4f6f8}
.card{border-radius:12px}
th{white-space:nowrap}
</style>
</head>
<body>

<div class="container mt-4">

<!-- LOGIN -->
<div id="loginBox" class="row justify-content-center">
<div class="col-md-4">
<div class="card p-4 shadow">
<h4 class="text-center mb-3">Login Admin</h4>
<input id="user" class="form-control mb-2" placeholder="Username">
<input id="pass" type="password" class="form-control mb-3" placeholder="Password">
<button class="btn btn-primary w-100" onclick="login()">Login</button>
</div>
</div>
</div>

<!-- DASHBOARD -->
<div id="dashboard" style="display:none">

<div class="d-flex justify-content-between align-items-center mb-3">
<h3>Dashboard Penjualan</h3>
<button class="btn btn-danger" onclick="logout()">Logout</button>
</div>

<div class="alert alert-success">
Total Belanja: <b id="totalBelanja">Rp 0</b>
</div>

<div class="mb-2">
<input id="catatanCheckout" class="form-control" placeholder="Catatan struk (nama pelanggan / keterangan)">
</div>

<div class="d-flex gap-2 mb-3">
<input id="search" class="form-control" placeholder="Cari barang..." onkeyup="render()">
<button class="btn btn-success" onclick="checkout()">Checkout & Cetak</button>
<button class="btn btn-secondary" onclick="toggleRiwayat()">Riwayat</button>
</div>

<!-- TABEL BARANG -->
<div class="table-responsive">
<table class="table table-bordered table-striped">
<thead class="table-dark">
<tr>
<th>No</th><th>Nama Barang</th><th>Harga</th><th>Qty</th><th>Subtotal</th><th>Aksi</th>
</tr>
</thead>
<tbody id="tbody"></tbody>
</table>
</div>

<!-- RIWAYAT -->
<div id="riwayatBox" style="display:none">
<h4 class="mt-4">Riwayat Transaksi</h4>

<div class="row mb-2">
<div class="col-md-4">
<input type="date" id="filterTanggal" class="form-control" onchange="renderRiwayat()">
</div>
<div class="col-md-2">
<button class="btn btn-outline-secondary w-100" onclick="clearTanggal()">Semua</button>
</div>
</div>

<table class="table table-bordered table-sm">
<thead class="table-secondary">
<tr>
<th>Tanggal</th><th>Catatan</th><th>Detail</th><th>Total</th>
</tr>
</thead>
<tbody id="riwayatBody"></tbody>
</table>
</div>

</div>
</div>

<script>
const ADMIN={user:'Santika Jaya',pass:'Santika1'};
function login(){
 if(user.value===ADMIN.user && pass.value===ADMIN.pass){
  localStorage.setItem('login','1');
  loginBox.style.display='none';
  dashboard.style.display='block';
 } else alert('Login gagal');
}
function logout(){localStorage.removeItem('login');location.reload();}

let data=JSON.parse(localStorage.getItem('data'))||[
{nama:'INTISARI',harga:50000,qty:0},
{nama:'INTISARI HIJAU',harga:62000,qty:0},
{nama:'ANGGUR MERAH',harga:64000,qty:0},
{nama:'ANGGUR MERAH GOLD',harga:67000,qty:0},
{nama:'ARAK',harga:67000,qty:0},
{nama:'KOLESOM KUNING',harga:64000,qty:0},
{nama:'KOLESOM BIRU',harga:64000,qty:0},
{nama:'ANGGUR PUTIH',harga:64000,qty:0},
{nama:'API',harga:750000,qty:0},
{nama:'KAWA-KAWA',harga:73000,qty:0},
{nama:'KAWA-KAWA BLACK KARENT',harga:73000,qty:0},
{nama:'ELEXIS',harga:65000,qty:0},
{nama:'NEW PORT',harga:67000,qty:0},
{nama:'ANGGUR KETAN HITAM',harga:64000,qty:0},
{nama:'MCDONALD ANGGUR MERAH',harga:60000,qty:0},
{nama:'A.K HIJAU',harga:65000,qty:0},
{nama:'A.K MERAH',harga:65000,qty:0},
{nama:'INTISARI KECIL',harga:27000,qty:0},
{nama:'ARAK KECIL',harga:33000,qty:0},
{nama:'KOLESOM KECIL',harga:33000,qty:0},
{nama:'A.M KECIL',harga:33000,qty:0},
{nama:'A.M GOLD KECIL',harga:350000,qty:0},
{nama:'ASOKA',harga:30000,qty:0},
{nama:'TOPI MIRING',harga:30000,qty:0},
{nama:'MC DONALD',harga:50000,qty:0},
{nama:'JACK TRUE',harga:50000,qty:0},
{nama:'CONG YANG',harga:50000,qty:0},
{nama:'INTISARI HIJAU KECIL',harga:35000,qty:0},
{nama:'QURO',harga:70000,qty:0},
{nama:'INTISARI ANGGUR MERAH',harga:60000,qty:0},
{nama:'VODKA MIX',harga:30000,qty:0},
{nama:'BATAVIA',harga:370000,qty:0},
{nama:'ATLAS',harga:73000,qty:0},
{nama:'KAWA-KAWA KECIL',harga:43000,qty:0},
{nama:'FRIENDSHIP BLACK TEA',harga:73000,qty:0},
{nama:'ANKER LECI',harga:27000,qty:0},
{nama:'BULWISK KECIL',harga:100000,qty:0},
{nama:'BULWISK BESAR',harga:180000,qty:0},
{nama:'API PUTIH',harga:75000,qty:0},
{nama:'TOTAL GINSENG',harga:45000,qty:0},
{nama:'CLOUD SEVEN',harga:27000,qty:0},
{nama:'AMER RASA',harga:25000,qty:0},
{nama:'FRIENDSHIP GEPENG',harga:40000,qty:0},
{nama:'BALEGA',harga:73000,qty:0},
{nama:'BINTANG LEMON',harga:30000,qty:0},
{nama:'VIBE KECIL',harga:180000,qty:0},
{nama:'BARANAGA',harga:160000,qty:0},
{nama:'CAPTAIN MORGAN BESAR',harga:350000,qty:0},
{nama:'CAPTAIN MORGAN KECIL',harga:110000,qty:0},
{nama:'VIBE BESAR',harga:330000,qty:0},
{nama:'ICELAND 250 ML',harga:70000,qty:0},
{nama:'ICELAND 500 ML',harga:115000,qty:0},
{nama:'ICELAND 700 ML',harga:180000,qty:0},
{nama:'ICELAND 700 ML ORANGE',harga:180000,qty:0},
{nama:'ICELAND 700 ML CYTRUS',harga:180000,qty:0},
{nama:'DRUM 250 ML',harga:70000,qty:0},
{nama:'DRUM 350 ML',harga:95000,qty:0},
{nama:'DRUM 700 ML',harga:175000,qty:0},
{nama:'GILBEYS',harga:120000,qty:0},
{nama:'MANSIONS',harga:120000,qty:0},
{nama:'SIMIRNOF',harga:95000,qty:0},
{nama:'FRIENDSHIP',harga:70000,qty:0},
{nama:'SOJU ORI',harga:80000,qty:0},
{nama:'SOJU LECI',harga:80000,qty:0},
{nama:'SOJU DAEBAK',harga:80000,qty:0},
{nama:'KAMPUT',harga:60000,qty:0},
{nama:'ANKER',harga:37000,qty:0},
{nama:'ANKER STOUT',harga:28000,qty:0},
{nama:'BIR BINTANG',harga:43000,qty:0},
{nama:'BIR DRAFT',harga:30000,qty:0},
{nama:'BIR PROST',harga:35000,qty:0},
{nama:'GUINNES JUMBO',harga:53000,qty:0},
{nama:'GUINNES KECIL',harga:35000,qty:0},
{nama:'GUINNES KALENG',harga:40000,qty:0},
{nama:'ANKER KALENG BESAR',harga:32000,qty:0},
{nama:'ANKER KALENG KECIL',harga:25000,qty:0},
{nama:'BINTANG KALENG BESAR',harga:35000,qty:0},
{nama:'SINGARAJA KALENG',harga:28000,qty:0},
{nama:'SINGARAJA BOTOL',harga:30000,qty:0},
{nama:'MIX-MAX',harga:30000,qty:0},
{nama:'JOKER',harga:70000,qty:0},
{nama:'ROOT BEER',harga:10000,qty:0},
{nama:'GREEN SAND',harga:10000,qty:0},
{nama:'TEBS',harga:10000,qty:0},
{nama:'KRATINDENG',harga:7000,qty:0},
{nama:'SODA',harga:8000,qty:0},
{nama:'COCA-COLA',harga:5000,qty:0},
{nama:'SPRITE',harga:5000,qty:0},
{nama:'FANTA',harga:5000,qty:0}
];

let riwayat=JSON.parse(localStorage.getItem('riwayat'))||[];

function save(){
 localStorage.setItem('data',JSON.stringify(data));
 localStorage.setItem('riwayat',JSON.stringify(riwayat));
}

function render(){
 tbody.innerHTML='';
 let total=0;
 const f=search.value.toUpperCase();
 data.forEach((d,i)=>{
  if(!d.nama.toUpperCase().includes(f))return;
  const sub=d.qty*d.harga; total+=sub;
  tbody.innerHTML+=`
  <tr>
  <td>${i+1}</td>
  <td>${d.nama}</td>
  <td>Rp ${d.harga.toLocaleString('id-ID')}</td>
  <td><input type="number" min="0" value="${d.qty}"
  onchange="data[${i}].qty=this.value;save();render()"></td>
  <td>Rp ${sub.toLocaleString('id-ID')}</td>
  <td><button class="btn btn-warning btn-sm" onclick="editItem(${i})">Edit</button></td>
  </tr>`;
 });
 totalBelanja.innerText='Rp '+total.toLocaleString('id-ID');
}

function editItem(i){
 const n=prompt('Nama Barang',data[i].nama);
 const h=prompt('Harga',data[i].harga);
 if(n&&h){data[i].nama=n;data[i].harga=+h;save();render();}
}

function checkout(){
 let items=[],total=0;
 data.forEach(d=>{
  if(d.qty>0){
   const sub=d.qty*d.harga;
   items.push(`${d.nama} x${d.qty} = Rp ${sub.toLocaleString('id-ID')}`);
   total+=sub; d.qty=0;
  }
 });
 if(!items.length)return alert('Tidak ada barang');
 const t=new Date();
 const catatan=catatanCheckout.value||'-';
 riwayat.push({
  waktu:t.toLocaleString('id-ID'),
  tanggal:t.toISOString().slice(0,10),
  catatan,items,total
 });
 catatanCheckout.value='';
 save(); render(); renderRiwayat();

 const {jsPDF}=window.jspdf;
 const doc=new jsPDF();
 let y=20;
 doc.text('STRUK PEMBELIAN',14,10);
 doc.text(t.toLocaleString('id-ID'),14,16);
 doc.text('Catatan: '+catatan,14,22);
 y=30;
 items.forEach(i=>{doc.text(i,14,y);y+=6});
 doc.text(`TOTAL: Rp ${total.toLocaleString('id-ID')}`,14,y+4);
 doc.save('struk.pdf');
}

function renderRiwayat(){
 riwayatBody.innerHTML='';
 const f=filterTanggal.value;
 riwayat.slice().reverse().forEach(r=>{
  if(f && r.tanggal!==f)return;
  riwayatBody.innerHTML+=`
  <tr>
  <td>${r.waktu}</td>
  <td>${r.catatan}</td>
  <td>${r.items.join('<br>')}</td>
  <td>Rp ${r.total.toLocaleString('id-ID')}</td>
  </tr>`;
 });
}
function clearTanggal(){filterTanggal.value='';renderRiwayat();}
function toggleRiwayat(){
 riwayatBox.style.display=riwayatBox.style.display==='none'?'block':'none';
 renderRiwayat();
}

if(localStorage.getItem('login')){
 loginBox.style.display='none';
 dashboard.style.display='block';
}
render();
</script>

</body>
</html>